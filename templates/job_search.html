{% extends "base.html" %}

{% block title %}Job Search - Job Application Automation{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h1 class="mb-4">
            <i class="fas fa-search"></i> Job Search
        </h1>
    </div>
</div>

<div class="row">
    <div class="col-md-3">
        <!-- Search Filters -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-filter"></i> Search Filters
                </h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label for="roles" class="form-label">Target Roles *</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="roles" value="Prompt Engineer" 
                                   {% if 'Prompt Engineer' in (search_criteria.roles or []) %}checked{% endif %}>
                            <label class="form-check-label">Prompt Engineer</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="roles" value="AI Engineer" 
                                   {% if 'AI Engineer' in (search_criteria.roles or []) %}checked{% endif %}>
                            <label class="form-check-label">AI Engineer</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="roles" value="Machine Learning Engineer" 
                                   {% if 'Machine Learning Engineer' in (search_criteria.roles or []) %}checked{% endif %}>
                            <label class="form-check-label">Machine Learning Engineer</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="roles" value="Data Scientist" 
                                   {% if 'Data Scientist' in (search_criteria.roles or []) %}checked{% endif %}>
                            <label class="form-check-label">Data Scientist</label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="experience_range" class="form-label">Experience Range</label>
                        <div class="row">
                            <div class="col-6">
                                <input type="number" class="form-control" name="experience_min" placeholder="Min" 
                                       value="{{ search_criteria.experience_min or 0 }}" min="0" max="10">
                            </div>
                            <div class="col-6">
                                <input type="number" class="form-control" name="experience_max" placeholder="Max" 
                                       value="{{ search_criteria.experience_max or 3 }}" min="0" max="10">
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="salary_min" class="form-label">Minimum Salary (INR)</label>
                        <input type="number" class="form-control" name="salary_min" 
                               value="{{ search_criteria.salary_min or 700000 }}" step="50000" min="0">
                    </div>
                    
                    <div class="mb-3">
                        <label for="location" class="form-label">Location</label>
                        <select class="form-select" name="location">
                            <option value="Remote" {% if search_criteria.location == 'Remote' %}selected{% endif %}>Remote</option>
                            <option value="Kolkata" {% if search_criteria.location == 'Kolkata' %}selected{% endif %}>Kolkata</option>
                            <option value="Bangalore" {% if search_criteria.location == 'Bangalore' %}selected{% endif %}>Bangalore</option>
                            <option value="Mumbai" {% if search_criteria.location == 'Mumbai' %}selected{% endif %}>Mumbai</option>
                            <option value="Delhi" {% if search_criteria.location == 'Delhi' %}selected{% endif %}>Delhi</option>
                            <option value="Hyderabad" {% if search_criteria.location == 'Hyderabad' %}selected{% endif %}>Hyderabad</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Job Portals</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="portals" value="linkedin" 
                                   {% if 'linkedin' in (search_criteria.portals or []) %}checked{% endif %}>
                            <label class="form-check-label">LinkedIn</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="portals" value="naukri" 
                                   {% if 'naukri' in (search_criteria.portals or []) %}checked{% endif %}>
                            <label class="form-check-label">Naukri.com</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="portals" value="indeed" 
                                   {% if 'indeed' in (search_criteria.portals or []) %}checked{% endif %}>
                            <label class="form-check-label">Indeed</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="portals" value="wellfound" 
                                   {% if 'wellfound' in (search_criteria.portals or []) %}checked{% endif %}>
                            <label class="form-check-label">Wellfound</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="portals" value="remoteok" 
                                   {% if 'remoteok' in (search_criteria.portals or []) %}checked{% endif %}>
                            <label class="form-check-label">RemoteOK</label>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-search"></i> Search Jobs
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-9">
        <!-- Search Results -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-list"></i> Search Results
                    {% if jobs %}
                        <span class="badge bg-primary ms-2">{{ jobs|length }} jobs found</span>
                    {% endif %}
                </h5>
                
                {% if jobs %}
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-success" onclick="selectAllJobs()">
                        <i class="fas fa-check-double"></i> Select All
                    </button>
                    <button type="button" class="btn btn-warning" onclick="applyToSelected()">
                        <i class="fas fa-paper-plane"></i> Apply to Selected
                    </button>
                </div>
                {% endif %}
            </div>
            <div class="card-body">
                {% if jobs %}
                    <form id="applyForm" method="POST" action="{{ url_for('apply_jobs') }}">
                        <div class="row">
                            {% for job in jobs %}
                            <div class="col-md-6 mb-3">
                                <div class="card job-card">
                                    <div class="card-body">
                                        <div class="form-check mb-2">
                                            <input class="form-check-input job-checkbox" type="checkbox" 
                                                   name="job_ids" value="{{ job.id }}" id="job_{{ job.id }}">
                                            <label class="form-check-label" for="job_{{ job.id }}">
                                                <strong>{{ job.title }}</strong>
                                            </label>
                                        </div>
                                        
                                        <div class="job-details">
                                            <p class="mb-1">
                                                <i class="fas fa-building"></i> {{ job.company }}
                                            </p>
                                            <p class="mb-1">
                                                <i class="fas fa-map-marker-alt"></i> {{ job.location }}
                                            </p>
                                            {% if job.salary %}
                                            <p class="mb-1">
                                                <i class="fas fa-rupee-sign"></i> {{ job.salary }}
                                            </p>
                                            {% endif %}
                                            <p class="mb-1">
                                                <span class="badge bg-secondary">{{ job.portal }}</span>
                                            </p>
                                            
                                            {% if job.description %}
                                            <div class="job-description">
                                                <p class="text-muted small">{{ job.description[:200] }}...</p>
                                            </div>
                                            {% endif %}
                                            
                                            <div class="d-flex justify-content-between align-items-center mt-2">
                                                <small class="text-muted">
                                                    <i class="fas fa-clock"></i> Posted recently
                                                </small>
                                                <a href="{{ job.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-external-link-alt"></i> View
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        
                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="fas fa-paper-plane"></i> Apply to Selected Jobs
                            </button>
                        </div>
                    </form>
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">No jobs found</h5>
                        <p class="text-muted">Try adjusting your search criteria or select different job portals.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Search Tips -->
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-lightbulb"></i> Search Tips
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6><i class="fas fa-bullseye"></i> Targeting</h6>
                        <p class="text-muted small">Select specific roles that match your skills. "AI Engineer" and "Prompt Engineer" are hot right now.</p>
                    </div>
                    <div class="col-md-4">
                        <h6><i class="fas fa-money-bill-wave"></i> Salary</h6>
                        <p class="text-muted small">Set realistic salary expectations. ₹7-12 LPA is common for 0-3 years experience in AI/ML.</p>
                    </div>
                    <div class="col-md-4">
                        <h6><i class="fas fa-globe"></i> Location</h6>
                        <p class="text-muted small">Remote jobs offer more opportunities. Consider both remote and local options.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function selectAllJobs() {
    const checkboxes = document.querySelectorAll('.job-checkbox');
    const allChecked = Array.from(checkboxes).every(cb => cb.checked);
    
    checkboxes.forEach(checkbox => {
        checkbox.checked = !allChecked;
    });
}

function applyToSelected() {
    const selectedJobs = document.querySelectorAll('.job-checkbox:checked');
    
    if (selectedJobs.length === 0) {
        alert('Please select at least one job to apply to.');
        return;
    }
    
    if (confirm(`Are you sure you want to apply to ${selectedJobs.length} selected jobs?`)) {
        document.getElementById('applyForm').submit();
    }
}

// Auto-select/deselect on card click
document.addEventListener('DOMContentLoaded', function() {
    const jobCards = document.querySelectorAll('.job-card');
    
    jobCards.forEach(card => {
        card.addEventListener('click', function(e) {
            if (e.target.type !== 'checkbox' && e.target.tagName !== 'A' && e.target.tagName !== 'BUTTON') {
                const checkbox = card.querySelector('.job-checkbox');
                checkbox.checked = !checkbox.checked;
            }
        });
    });
});
</script>
{% endblock %}